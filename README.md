# 10-04hw 10.4 «Резервное копирование» - Дрибноход Давид

## Задание 1.
1. Полное – это резервное копирование, при котором снимок операционной системы, диска,  раздела или отдельных папок содержит все резервируемые данные. Такие снимки, создаваемые в  рамках одной и той же задачи по бэкапу, независимы друг от друга, повреждение одного из них  никак не повлияет на другие снимки. Это самый надёжный метод резервного копирования, но, вместе с  тем, самый затратный по ресурсам дискового пространства.

2. Дифференциальное – это такое резервное копирование, при котором полная копия создаётся единожды в начале, а все  последующие копии, создаваемые в рамках одной и той же задачи, содержат не все данные, а лишь произошедшие изменения  с момента создания первичной полной копии. Ключевой момент здесь – с момента создания полной копии. Тогда как при  инкрементом копировании вторая инкрементная копия цепочки являет собой разницу между ней и первой копией, при  дифференциальном и первая, и вторая, и третья, и четвёртая, и все следующие дифференциальные копии будут зависимыми  только от полной копии. Но никак не зависимыми друг от друга. Удаление или повреждение любой из дифференциальных  копий не повлияет на другие копии – ни на те, что создавались до удалённой (повреждённой), ни на те, что после неё.

3. Инкрементное – это такое резервное копирование, при котором полная копия создаётся единожды в  начале, а все последующие копии, создаваемые в рамках одной и той же задачи, содержат не все данные,  а лишь произошедшие изменения - какие файлы удалены, а какие добавлены. Первая инкрементная копия содержит  разницу в данных между ней самой и полной копией. А вторая инкрементная копия содержит разницу между ней самой и  первой инкрементной копией. Третья – между ней самой и второй. И так далее. Каждая новая инкрементная копия зависит  от своей предшественницы и не может быть задействована для процесса восстановления без такой предшественницы. Ну и,  конечно же, без полной первичной копии.


## Задание 2.
#### Выполнение резервного копирования
![Скриншот 1](https://github.com/DrDavidN/10-04hw/blob/main/img/10-04z2_1.JPG)
#### bacula-dir.conf
![Скриншот 2](https://github.com/DrDavidN/10-04hw/blob/main/img/10-04z2_2.JPG)
![Скриншот 3](https://github.com/DrDavidN/10-04hw/blob/main/img/10-04z2_3.JPG)
![Скриншот 4](https://github.com/DrDavidN/10-04hw/blob/main/img/10-04z2_4.JPG)
#### bacula-sd.conf
![Скриншот 5](https://github.com/DrDavidN/10-04hw/blob/main/img/10-04z2_5.JPG)
![Скриншот 6](https://github.com/DrDavidN/10-04hw/blob/main/img/10-04z2_6.JPG)
#### bacula-fd.conf
![Скриншот 7](https://github.com/DrDavidN/10-04hw/blob/main/img/10-04z2_7.JPG)

## Задание 3.
#### nodeone
##### /etc/rsyncd.conf 
```
pid file = /var/run/rsyncd.pid
log file = /var/log/rsyncd.log
transfer logging = true
munge symlinks = yes

```

##### backup-node1.sh
```
#!/bin/bash
date
# Папка, куда будем складывать архивы — ее либо сразу создать либо не создавать а положить в уже существующие
syst_dir=/backup/
# Имя сервера, который архивируем
srv_name=nodetwo #из тестовой конфигурации
# Адрес сервера, который архивируем
srv_ip=192.168.0.2
# Пользователь rsync на сервере, который архивируем
srv_user=backup
# Ресурс на сервере для бэкапа
srv_dir=data
echo "Start backup ${srv_name}"
# Создаем папку для инкрементных бэкапов
mkdir -p ${syst_dir}${srv_name}/increment/
/usr/bin/rsync -avz --progress --delete --password-file=/etc/rsyncd.scrt ${srv_user}@${srv_ip}::${srv_dir} ${syst_dir}${srv_name}/current/ ->
/usr/bin/find ${syst_dir}${srv_name}/increment/ -maxdepth 1 -type d -mtime +30 -exec rm -rf {} \;
date
echo "Finish backup ${srv_name}"

```

#### nodetwo
##### /etc/rsyncd.conf
```

pid file = /var/run/rsyncd.pid
log file = /var/log/rsyncd.log
transfer logging = true
munge symlinks = yes
# папка источник для бэкапа
[data]
path = /home/dribnokhod
uid = root
read only = yes
list = yes
comment = Data backup Dir
auth users = backup
secrets file = /etc/rsyncd.scrt

```

